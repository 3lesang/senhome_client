---
import LoaderCircle from "@lucide/astro/icons/loader-circle";
---

<script>
  import { pb, USER_COLLECTION } from "@/lib/pocketbase";
  import Alpine from "alpinejs";

  function signUpForm(): {
    isPending: boolean;
    isError: boolean;
    isSuccess: boolean;
    name: string;
    phone: string;
    email: string;
    password: string;
    $dispatch?: (event: string) => void;
    submit(): void;
  } {
    return {
      isPending: false,
      isError: false,
      isSuccess: false,
      name: "",
      phone: "",
      email: "",
      password: "",
      async submit() {
        try {
          this.isPending = true;
          const res = await pb.collection(USER_COLLECTION).create({
            name: this.name,
            phone: this.phone,
            email: this.email,
            password: this.password,
            passwordConfirm: this.password,
          });
          this.isPending = false;
          if (res.id) {
            this.isSuccess = true;
            this.name = "";
            this.phone = "";
            this.email = "";
            this.password = "";
          }
        } catch (error) {
          this.isError = true;
          this.isPending = false;
        }
      },
    };
  }
  document.addEventListener("alpine:init", () => {
    Alpine.data("signUpForm", () => signUpForm());
  });
</script>
<form x-data="signUpForm" @submit.prevent="submit">
  <div class="grid grid-cols-2 gap-4">
    <div class="col-span-1">
      <div class="flex flex-col gap-1">
        <label for="name">Họ tên</label>
        <input
          id="name"
          x-model="name"
          type="text"
          class="border py-2 px-2 rounded"
          placeholder="Họ tên"
        />
      </div>
    </div>
    <div class="col-span-1">
      <div class="flex flex-col gap-1">
        <label for="phone">Số điện thoại</label>
        <input
          id="phone"
          x-model="phone"
          type="text"
          class="border py-2 px-2 rounded"
          placeholder="Số điện thoại"
        />
      </div>
    </div>
    <div class="col-span-2">
      <div class="flex flex-col gap-1">
        <label for="email">Email</label>
        <input
          id="email"
          x-model="email"
          type="text"
          class="border py-2 px-2 rounded"
          placeholder="Email"
        />
      </div>
    </div>
    <div class="col-span-2">
      <div class="flex flex-col gap-1">
        <label for="password">Mật khẩu</label>
        <input
          id="password"
          x-model="password"
          type="password"
          class="border py-2 px-2 rounded"
          placeholder="Mật khẩu"
        />
      </div>
    </div>
  </div>
  <div class="mt-8">
    <button
      :disabled="isPending"
      type="submit"
      class="flex items-center justify-center gap-2 disabled:bg-gray-400 disabled:cursor-default bg-blue-500 hover:bg-blue-600 text-white font-bold rounded w-full px-4 py-2 cursor-pointer"
    >
      <LoaderCircle size={16} x-show="isPending" class="animate-spin" />
      <span>Đăng ký tài khoản</span>
    </button>
  </div>

  <small x-show="isError" class="text-red-500"
    >Đăng ký tài khoản không thàng công</small
  >
  <small x-show="isSuccess" class="text-blue-500"
    >Đăng ký tài khoản thàng công! Hãy đăng nhập ngay</small
  >
</form>
